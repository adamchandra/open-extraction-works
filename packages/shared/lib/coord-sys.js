function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

/**
 * Define and translate between the various coordinate systems used:
 *
 *
 *    PDF Media coords - (PDF-extracted page geometry and char bounding boxes)
 *    Single-Page Image coords - coords within the svg containing page image, scaled version of Media coords
 *    Screen event coords - e.g., where a user clicks on a page
 *    Client Pages View  - Absolute coords within the vertical scroll
 *                         list of page svgs/images (regardless of scroll position)
 *    Client Text View  - coords within the vertical scroll list of page text blocks  (regardless of scroll position)
 *
 *    event page/client/screen/offset explanations:
 *       https://stackoverflow.com/questions/6073505/what-is-the-difference-between-screenx-y-clientx-y-and-pagex-y
 */
export let CoordSys;

(function (CoordSys) {
  CoordSys[CoordSys["Unknown"] = 0] = "Unknown";
  CoordSys[CoordSys["Screen"] = 1] = "Screen";
  CoordSys[CoordSys["Div"] = 2] = "Div";
  CoordSys[CoordSys["GraphUnits"] = 3] = "GraphUnits";
  CoordSys[CoordSys["PdfMedia"] = 4] = "PdfMedia";
})(CoordSys || (CoordSys = {}));

export class Point {
  constructor(x, y, sys) {
    _defineProperty(this, "x", void 0);

    _defineProperty(this, "y", void 0);

    _defineProperty(this, "sys", void 0);

    this.x = x;
    this.y = y;
    this.sys = sys ? sys : CoordSys.Unknown; // this.type = "Point";
  }

  svgShape() {
    return {
      type: "circle",
      r: 3,
      cx: this.x,
      cy: this.y
    };
  }

}

class Line {
  constructor(p1, p2) {
    _defineProperty(this, "p1", void 0);

    _defineProperty(this, "p2", void 0);

    _defineProperty(this, "sys", CoordSys.Unknown);

    this.p1 = p1;
    this.p2 = p2;
  }

  svgShape() {
    return {
      type: "line",
      x1: this.p1.x,
      x2: this.p2.x,
      y1: this.p1.y,
      y2: this.p2.y
    };
  }

}

class Trapezoid {
  constructor(top, bottom) {
    _defineProperty(this, "topLine", void 0);

    _defineProperty(this, "bottomLine", void 0);

    this.topLine = top;
    this.bottomLine = bottom;
  }

  svgShape() {
    const p1 = this.topLine.p1;
    const p2 = this.topLine.p2;
    const p3 = this.bottomLine.p2;
    const p4 = this.bottomLine.p1;
    return {
      type: "path",
      d: `M ${p1.x} ${p1.y} L ${p2.x} ${p2.y} L ${p3.x} ${p3.y} L ${p4.x} ${p4.y} Z`
    };
  }

}

export let mkPoint = {
  fromXy: (x, y, sys = CoordSys.Unknown) => {
    return new Point(x, y, sys);
  },
  fromD3Mouse: d3Mouse => {
    return new Point(d3Mouse[0], d3Mouse[1], CoordSys.Screen);
  },
  offsetFromJqEvent: event => {
    return mkPoint.fromXy(event.offsetX, event.offsetY, CoordSys.Screen);
  },
  fromFloatReps: o => {
    return new Point(o.x / 100.0, o.y / 100.0, CoordSys.PdfMedia);
  }
};
export function pointFloor(p) {
  return mkPoint.fromXy(Math.floor(p.x), Math.floor(p.y), p.sys);
}
/**
 *  General purpose bounding box data that meets the interface requirements
 *  for the various libraries in use
 */

export class BBox {
  // public bottom: number;
  // public minX: number;
  // public minY: number;
  // public maxX: number;
  // public maxY: number;
  constructor(l, t, w, h, sys) {
    _defineProperty(this, "left", void 0);

    _defineProperty(this, "top", void 0);

    _defineProperty(this, "width", void 0);

    _defineProperty(this, "height", void 0);

    _defineProperty(this, "sys", void 0);

    this.left = l;
    this.top = t;
    this.width = w;
    this.height = h;
    this.sys = sys ? sys : CoordSys.Unknown;
  }

  get minX() {
    return this.left;
  }

  get minY() {
    return this.top;
  }

  get maxX() {
    return this.left + this.width;
  }

  get maxY() {
    return this.top + this.height;
  }

  get x() {
    return this.left;
  }

  get y() {
    return this.top;
  }

  get x1() {
    return this.left;
  }

  get x2() {
    return this.left + this.width;
  }

  get y1() {
    return this.top;
  }

  get y2() {
    return this.top + this.height;
  }

  get bottom() {
    return this.top + this.height;
  }

  get right() {
    return this.left + this.width;
  }

  get topLeft() {
    return mkPoint.fromXy(this.left, this.top, this.sys);
  }

  get centerPoint() {
    const x = this.minX + this.width / 2;
    const y = this.minY + this.height / 2;
    return mkPoint.fromXy(x, y, this.sys);
  } // set system(s)  { this._system = s; }
  // get system()   { return this._system; }


  get intRep() {
    return [Math.trunc(this.left * 100.0), Math.trunc(this.top * 100.0), Math.trunc(this.width * 100.0), Math.trunc(this.height * 100.0)];
  }

  toString() {
    return `BBox(${this.left}, ${this.top}, ${this.width}, ${this.height})`;
  }

  svgShape() {
    return {
      type: "rect",
      x: this.x,
      y: this.y,
      width: this.width,
      height: this.height
    };
  }

}
export let mk = {
  fromLtwhFloatReps: o => {
    return new BBox(o.left / 100.0, o.top / 100.0, o.width / 100.0, o.height / 100.0, CoordSys.Unknown);
  },
  fromLtwh: (l, t, w, h) => {
    return new BBox(l, t, w, h, CoordSys.Unknown);
  },
  fromLtwhObj: o => {
    return new BBox(o.left, o.top, o.width, o.height, CoordSys.Unknown);
  },
  fromArray: ltwh => {
    const left = ltwh[0] / 100.0;
    const top = ltwh[1] / 100.0;
    const width = ltwh[2] / 100.0;
    const height = ltwh[3] / 100.0;
    return new BBox(left, top, width, height, CoordSys.PdfMedia);
  }
};
export function boxCenteredAt(p, width, height) {
  const left = p.x - width / 2;
  const top = p.y - height / 2;
  return mk.fromLtwh(left, top, width, height);
}
export function fromFigure(fig) {
  let shape;

  if (fig.LTBounds) {
    shape = mk.fromArray(fig.LTBounds);
  } else if (fig.Line) {
    const p1 = mkPoint.fromFloatReps(fig.Line.p1);
    const p2 = mkPoint.fromFloatReps(fig.Line.p2);
    shape = new Line(p1, p2);
  } else if (fig.Point) {
    shape = mkPoint.fromFloatReps(fig.Point);
  } else if (fig.Trapezoid) {
    const topP1 = mkPoint.fromFloatReps(fig.Trapezoid.topLeft);
    const topP2 = mkPoint.fromFloatReps({
      x: fig.Trapezoid.topLeft.x + fig.Trapezoid.topWidth,
      y: fig.Trapezoid.topLeft.y
    });
    const bottomP1 = mkPoint.fromFloatReps(fig.Trapezoid.bottomLeft);
    const bottomP2 = mkPoint.fromFloatReps({
      x: fig.Trapezoid.bottomLeft.x + fig.Trapezoid.bottomWidth,
      y: fig.Trapezoid.bottomLeft.y
    });
    const top = new Line(topP1, topP2);
    const bottom = new Line(bottomP1, bottomP2);
    shape = new Trapezoid(top, bottom);
  } else {
    throw new Error(`could not construct shape from figure ${fig}`);
  }

  return shape;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9jb29yZC1zeXMudHMiXSwibmFtZXMiOlsiQ29vcmRTeXMiLCJQb2ludCIsImNvbnN0cnVjdG9yIiwieCIsInkiLCJzeXMiLCJVbmtub3duIiwic3ZnU2hhcGUiLCJ0eXBlIiwiciIsImN4IiwiY3kiLCJMaW5lIiwicDEiLCJwMiIsIngxIiwieDIiLCJ5MSIsInkyIiwiVHJhcGV6b2lkIiwidG9wIiwiYm90dG9tIiwidG9wTGluZSIsImJvdHRvbUxpbmUiLCJwMyIsInA0IiwiZCIsIm1rUG9pbnQiLCJmcm9tWHkiLCJmcm9tRDNNb3VzZSIsImQzTW91c2UiLCJTY3JlZW4iLCJvZmZzZXRGcm9tSnFFdmVudCIsImV2ZW50Iiwib2Zmc2V0WCIsIm9mZnNldFkiLCJmcm9tRmxvYXRSZXBzIiwibyIsIlBkZk1lZGlhIiwicG9pbnRGbG9vciIsInAiLCJNYXRoIiwiZmxvb3IiLCJCQm94IiwibCIsInQiLCJ3IiwiaCIsImxlZnQiLCJ3aWR0aCIsImhlaWdodCIsIm1pblgiLCJtaW5ZIiwibWF4WCIsIm1heFkiLCJyaWdodCIsInRvcExlZnQiLCJjZW50ZXJQb2ludCIsImludFJlcCIsInRydW5jIiwidG9TdHJpbmciLCJtayIsImZyb21MdHdoRmxvYXRSZXBzIiwiZnJvbUx0d2giLCJmcm9tTHR3aE9iaiIsImZyb21BcnJheSIsImx0d2giLCJib3hDZW50ZXJlZEF0IiwiZnJvbUZpZ3VyZSIsImZpZyIsInNoYXBlIiwiTFRCb3VuZHMiLCJ0b3BQMSIsInRvcFAyIiwidG9wV2lkdGgiLCJib3R0b21QMSIsImJvdHRvbUxlZnQiLCJib3R0b21QMiIsImJvdHRvbVdpZHRoIiwiRXJyb3IiXSwibWFwcGluZ3MiOiI7O0FBQUE7Ozs7Ozs7Ozs7Ozs7O0FBZUEsV0FBWUEsUUFBWjs7V0FBWUEsUTtBQUFBQSxFQUFBQSxRLENBQUFBLFE7QUFBQUEsRUFBQUEsUSxDQUFBQSxRO0FBQUFBLEVBQUFBLFEsQ0FBQUEsUTtBQUFBQSxFQUFBQSxRLENBQUFBLFE7QUFB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LyoqXG4gKiBEZWZpbmUgYW5kIHRyYW5zbGF0ZSBiZXR3ZWVuIHRoZSB2YXJpb3VzIGNvb3JkaW5hdGUgc3lzdGVtcyB1c2VkOlxuICpcbiAqXG4gKiAgICBQREYgTWVkaWEgY29vcmRzIC0gKFBERi1leHRyYWN0ZWQgcGFnZSBnZW9tZXRyeSBhbmQgY2hhciBib3VuZGluZyBib3hlcylcbiAqICAgIFNpbmdsZS1QYWdlIEltYWdlIGNvb3JkcyAtIGNvb3JkcyB3aXRoaW4gdGhlIHN2ZyBjb250YWluaW5nIHBhZ2UgaW1hZ2UsIHNjYWxlZCB2ZXJzaW9uIG9mIE1lZGlhIGNvb3Jkc1xuICogICAgU2NyZWVuIGV2ZW50IGNvb3JkcyAtIGUuZy4sIHdoZXJlIGEgdXNlciBjbGlja3Mgb24gYSBwYWdlXG4gKiAgICBDbGllbnQgUGFnZXMgVmlldyAgLSBBYnNvbHV0ZSBjb29yZHMgd2l0aGluIHRoZSB2ZXJ0aWNhbCBzY3JvbGxcbiAqICAgICAgICAgICAgICAgICAgICAgICAgIGxpc3Qgb2YgcGFnZSBzdmdzL2ltYWdlcyAocmVnYXJkbGVzcyBvZiBzY3JvbGwgcG9zaXRpb24pXG4gKiAgICBDbGllbnQgVGV4dCBWaWV3ICAtIGNvb3JkcyB3aXRoaW4gdGhlIHZlcnRpY2FsIHNjcm9sbCBsaXN0IG9mIHBhZ2UgdGV4dCBibG9ja3MgIChyZWdhcmRsZXNzIG9mIHNjcm9sbCBwb3NpdGlvbilcbiAqXG4gKiAgICBldmVudCBwYWdlL2NsaWVudC9zY3JlZW4vb2Zmc2V0IGV4cGxhbmF0aW9uczpcbiAqICAgICAgIGh0dHBzOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzYwNzM1MDUvd2hhdC1pcy10aGUtZGlmZmVyZW5jZS1iZXR3ZWVuLXNjcmVlbngteS1jbGllbnR4LXktYW5kLXBhZ2V4LXlcbiAqL1xuXG5leHBvcnQgZW51bSBDb29yZFN5cyB7XG4gIFVua25vd24sXG4gIFNjcmVlbixcbiAgRGl2LFxuICBHcmFwaFVuaXRzLFxuICBQZGZNZWRpYSxcbn1cblxuaW50ZXJmYWNlIElMVEJvdW5kc0ludFJlcCB7XG4gIGxlZnQ6IG51bWJlcjtcbiAgdG9wOiBudW1iZXI7XG4gIHdpZHRoOiBudW1iZXI7XG4gIGhlaWdodDogbnVtYmVyO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIElMVEJvdW5kcyB7XG4gIGxlZnQ6IG51bWJlcjtcbiAgdG9wOiBudW1iZXI7XG4gIHdpZHRoOiBudW1iZXI7XG4gIGhlaWdodDogbnVtYmVyO1xuICBtaW5YOiBudW1iZXI7XG4gIG1pblk6IG51bWJlcjtcbiAgbWF4WDogbnVtYmVyO1xuICBtYXhZOiBudW1iZXI7XG4gIHg6IG51bWJlcjtcbiAgeTogbnVtYmVyO1xuICB4MTogbnVtYmVyO1xuICB4MjogbnVtYmVyO1xuICB5MTogbnVtYmVyO1xuICB5MjogbnVtYmVyO1xuICBib3R0b206IG51bWJlcjtcbiAgcmlnaHQ6IG51bWJlcjtcbiAgdG9wTGVmdDogUG9pbnQ7XG59XG5cbmV4cG9ydCBjbGFzcyBQb2ludCB7XG4gIHB1YmxpYyB4OiBudW1iZXI7XG4gIHB1YmxpYyB5OiBudW1iZXI7XG4gIHB1YmxpYyBzeXM6IENvb3JkU3lzO1xuXG4gIHB1YmxpYyBjb25zdHJ1Y3Rvcih4OiBudW1iZXIsIHk6IG51bWJlciwgc3lzOiBDb29yZFN5cykge1xuICAgIHRoaXMueCA9IHg7XG4gICAgdGhpcy55ID0geTtcbiAgICB0aGlzLnN5cyA9IHN5cyA/IHN5cyA6IENvb3JkU3lzLlVua25vd247XG4gICAgLy8gdGhpcy50eXBlID0gXCJQb2ludFwiO1xuICB9XG5cbiAgcHVibGljIHN2Z1NoYXBlKCkge1xuICAgIHJldHVybiB7XG4gICAgICB0eXBlOiBcImNpcmNsZVwiLFxuICAgICAgcjogMyxcbiAgICAgIGN4OiB0aGlzLngsXG4gICAgICBjeTogdGhpcy55LFxuICAgIH07XG4gIH1cbn1cblxuY2xhc3MgTGluZSB7XG4gIHB1YmxpYyBwMTogUG9pbnQ7XG4gIHB1YmxpYyBwMjogUG9pbnQ7XG4gIHB1YmxpYyBzeXM6IENvb3JkU3lzID0gQ29vcmRTeXMuVW5rbm93bjtcblxuICBwdWJsaWMgY29uc3RydWN0b3IocDE6IFBvaW50LCBwMjogUG9pbnQpIHtcbiAgICB0aGlzLnAxID0gcDE7XG4gICAgdGhpcy5wMiA9IHAyO1xuICB9XG5cbiAgcHVibGljIHN2Z1NoYXBlKCkge1xuICAgIHJldHVybiB7XG4gICAgICB0eXBlOiBcImxpbmVcIixcbiAgICAgIHgxOiB0aGlzLnAxLngsXG4gICAgICB4MjogdGhpcy5wMi54LFxuICAgICAgeTE6IHRoaXMucDEueSxcbiAgICAgIHkyOiB0aGlzLnAyLnksXG4gICAgfTtcbiAgfVxufVxuY2xhc3MgVHJhcGV6b2lkIHtcbiAgcHVibGljIHRvcExpbmU6IExpbmU7XG4gIHB1YmxpYyBib3R0b21MaW5lOiBMaW5lO1xuXG4gIHB1YmxpYyBjb25zdHJ1Y3Rvcih0b3A6IExpbmUsIGJvdHRvbTogTGluZSkge1xuICAgIHRoaXMudG9wTGluZSA9IHRvcDtcbiAgICB0aGlzLmJvdHRvbUxpbmUgPSBib3R0b207XG4gIH1cblxuICBwdWJsaWMgc3ZnU2hhcGUoKSB7XG4gICAgY29uc3QgcDEgPSB0aGlzLnRvcExpbmUucDE7XG4gICAgY29uc3QgcDIgPSB0aGlzLnRvcExpbmUucDI7XG4gICAgY29uc3QgcDMgPSB0aGlzLmJvdHRvbUxpbmUucDI7XG4gICAgY29uc3QgcDQgPSB0aGlzLmJvdHRvbUxpbmUucDE7XG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGU6IFwicGF0aFwiLFxuICAgICAgZDogYE0gJHtwMS54fSAke3AxLnl9IEwgJHtwMi54fSAke3AyLnl9IEwgJHtwMy54fSAke3AzLnl9IEwgJHtwNC54fSAke1xuICAgICAgICBwNC55XG4gICAgICB9IFpgLFxuICAgIH07XG4gIH1cbn1cblxuZXhwb3J0IHR5cGUgQW55U2hhcGUgPSBQb2ludCB8IExpbmUgfCBUcmFwZXpvaWQgfCBCQm94O1xuXG5leHBvcnQgbGV0IG1rUG9pbnQgPSB7XG4gIGZyb21YeTogKHg6IG51bWJlciwgeTogbnVtYmVyLCBzeXM6IENvb3JkU3lzID0gQ29vcmRTeXMuVW5rbm93bikgPT4ge1xuICAgIHJldHVybiBuZXcgUG9pbnQoeCwgeSwgc3lzKTtcbiAgfSxcblxuICBmcm9tRDNNb3VzZTogKGQzTW91c2U6IFtudW1iZXIsIG51bWJlcl0pID0+IHtcbiAgICByZXR1cm4gbmV3IFBvaW50KGQzTW91c2VbMF0sIGQzTW91c2VbMV0sIENvb3JkU3lzLlNjcmVlbik7XG4gIH0sXG5cbiAgb2Zmc2V0RnJvbUpxRXZlbnQ6IChldmVudDogYW55KSA9PiB7XG4gICAgcmV0dXJuIG1rUG9pbnQuZnJvbVh5KGV2ZW50Lm9mZnNldFgsIGV2ZW50Lm9mZnNldFksIENvb3JkU3lzLlNjcmVlbik7XG4gIH0sXG5cbiAgZnJvbUZsb2F0UmVwczogKG86IGFueSkgPT4ge1xuICAgIHJldHVybiBuZXcgUG9pbnQoby54IC8gMTAwLjAsIG8ueSAvIDEwMC4wLCBDb29yZFN5cy5QZGZNZWRpYSk7XG4gIH0sXG59O1xuXG5leHBvcnQgZnVuY3Rpb24gcG9pbnRGbG9vcihwOiBQb2ludCkge1xuICByZXR1cm4gbWtQb2ludC5mcm9tWHkoTWF0aC5mbG9vcihwLngpLCBNYXRoLmZsb29yKHAueSksIHAuc3lzKTtcbn1cblxuLyoqXG4gKiAgR2VuZXJhbCBwdXJwb3NlIGJvdW5kaW5nIGJveCBkYXRhIHRoYXQgbWVldHMgdGhlIGludGVyZmFjZSByZXF1aXJlbWVudHNcbiAqICBmb3IgdGhlIHZhcmlvdXMgbGlicmFyaWVzIGluIHVzZVxuICovXG5leHBvcnQgY2xhc3MgQkJveCBpbXBsZW1lbnRzIElMVEJvdW5kcyB7XG4gIHB1YmxpYyBsZWZ0OiBudW1iZXI7XG4gIHB1YmxpYyB0b3A6IG51bWJlcjtcbiAgcHVibGljIHdpZHRoOiBudW1iZXI7XG4gIHB1YmxpYyBoZWlnaHQ6IG51bWJlcjtcbiAgcHVibGljIHN5czogQ29vcmRTeXM7XG4gIC8vIHB1YmxpYyBib3R0b206IG51bWJlcjtcbiAgLy8gcHVibGljIG1pblg6IG51bWJlcjtcbiAgLy8gcHVibGljIG1pblk6IG51bWJlcjtcbiAgLy8gcHVibGljIG1heFg6IG51bWJlcjtcbiAgLy8gcHVibGljIG1heFk6IG51bWJlcjtcblxuICBwdWJsaWMgY29uc3RydWN0b3IoXG4gICAgbDogbnVtYmVyLFxuICAgIHQ6IG51bWJlcixcbiAgICB3OiBudW1iZXIsXG4gICAgaDogbnVtYmVyLFxuICAgIHN5cz86IENvb3JkU3lzLFxuICApIHtcbiAgICB0aGlzLmxlZnQgPSBsO1xuICAgIHRoaXMudG9wID0gdDtcbiAgICB0aGlzLndpZHRoID0gdztcbiAgICB0aGlzLmhlaWdodCA9IGg7XG4gICAgdGhpcy5zeXMgPSBzeXMgPyBzeXMgOiBDb29yZFN5cy5Vbmtub3duO1xuICB9XG5cbiAgZ2V0IG1pblgoKSB7XG4gICAgcmV0dXJuIHRoaXMubGVmdDtcbiAgfVxuICBnZXQgbWluWSgpIHtcbiAgICByZXR1cm4gdGhpcy50b3A7XG4gIH1cbiAgZ2V0IG1heFgoKSB7XG4gICAgcmV0dXJuIHRoaXMubGVmdCArIHRoaXMud2lkdGg7XG4gIH1cbiAgZ2V0IG1heFkoKSB7XG4gICAgcmV0dXJuIHRoaXMudG9wICsgdGhpcy5oZWlnaHQ7XG4gIH1cblxuICBnZXQgeCgpIHtcbiAgICByZXR1cm4gdGhpcy5sZWZ0O1xuICB9XG4gIGdldCB5KCkge1xuICAgIHJldHVybiB0aGlzLnRvcDtcbiAgfVxuXG4gIGdldCB4MSgpIHtcbiAgICByZXR1cm4gdGhpcy5sZWZ0O1xuICB9XG4gIGdldCB4MigpIHtcbiAgICByZXR1cm4gdGhpcy5sZWZ0ICsgdGhpcy53aWR0aDtcbiAgfVxuICBnZXQgeTEoKSB7XG4gICAgcmV0dXJuIHRoaXMudG9wO1xuICB9XG4gIGdldCB5MigpIHtcbiAgICByZXR1cm4gdGhpcy50b3AgKyB0aGlzLmhlaWdodDtcbiAgfVxuXG4gIGdldCBib3R0b20oKSB7XG4gICAgcmV0dXJuIHRoaXMudG9wICsgdGhpcy5oZWlnaHQ7XG4gIH1cbiAgZ2V0IHJpZ2h0KCkge1xuICAgIHJldHVybiB0aGlzLmxlZnQgKyB0aGlzLndpZHRoO1xuICB9XG5cbiAgZ2V0IHRvcExlZnQoKSB7XG4gICAgcmV0dXJuIG1rUG9pbnQuZnJvbVh5KHRoaXMubGVmdCwgdGhpcy50b3AsIHRoaXMuc3lzKTtcbiAgfVxuXG4gIGdldCBjZW50ZXJQb2ludCgpIHtcbiAgICBjb25zdCB4ID0gdGhpcy5taW5YICsgdGhpcy53aWR0aCAvIDI7XG4gICAgY29uc3QgeSA9IHRoaXMubWluWSArIHRoaXMuaGVpZ2h0IC8gMjtcbiAgICByZXR1cm4gbWtQb2ludC5mcm9tWHkoeCwgeSwgdGhpcy5zeXMpO1xuICB9XG5cbiAgLy8gc2V0IHN5c3RlbShzKSAgeyB0aGlzLl9zeXN0ZW0gPSBzOyB9XG4gIC8vIGdldCBzeXN0ZW0oKSAgIHsgcmV0dXJuIHRoaXMuX3N5c3RlbTsgfVxuXG4gIGdldCBpbnRSZXAoKSB7XG4gICAgcmV0dXJuIFtcbiAgICAgIE1hdGgudHJ1bmModGhpcy5sZWZ0ICogMTAwLjApLFxuICAgICAgTWF0aC50cnVuYyh0aGlzLnRvcCAqIDEwMC4wKSxcbiAgICAgIE1hdGgudHJ1bmModGhpcy53aWR0aCAqIDEwMC4wKSxcbiAgICAgIE1hdGgudHJ1bmModGhpcy5oZWlnaHQgKiAxMDAuMCksXG4gICAgXTtcbiAgfVxuXG4gIHB1YmxpYyB0b1N0cmluZygpIHtcbiAgICByZXR1cm4gYEJCb3goJHt0aGlzLmxlZnR9LCAke3RoaXMudG9wfSwgJHt0aGlzLndpZHRofSwgJHt0aGlzLmhlaWdodH0pYDtcbiAgfVxuXG4gIHB1YmxpYyBzdmdTaGFwZSgpIHtcbiAgICByZXR1cm4ge1xuICAgICAgdHlwZTogXCJyZWN0XCIsXG4gICAgICB4OiB0aGlzLngsXG4gICAgICB5OiB0aGlzLnksXG4gICAgICB3aWR0aDogdGhpcy53aWR0aCxcbiAgICAgIGhlaWdodDogdGhpcy5oZWlnaHQsXG4gICAgfTtcbiAgfVxufVxuXG5leHBvcnQgbGV0IG1rID0ge1xuICBmcm9tTHR3aEZsb2F0UmVwczogKG86IElMVEJvdW5kc0ludFJlcCkgPT4ge1xuICAgIHJldHVybiBuZXcgQkJveChcbiAgICAgIG8ubGVmdCAvIDEwMC4wLFxuICAgICAgby50b3AgLyAxMDAuMCxcbiAgICAgIG8ud2lkdGggLyAxMDAuMCxcbiAgICAgIG8uaGVpZ2h0IC8gMTAwLjAsXG4gICAgICBDb29yZFN5cy5Vbmtub3duLFxuICAgICk7XG4gIH0sXG5cbiAgZnJvbUx0d2g6IChsOiBudW1iZXIsIHQ6IG51bWJlciwgdzogbnVtYmVyLCBoOiBudW1iZXIpID0+IHtcbiAgICByZXR1cm4gbmV3IEJCb3gobCwgdCwgdywgaCwgQ29vcmRTeXMuVW5rbm93bik7XG4gIH0sXG5cbiAgZnJvbUx0d2hPYmo6IChvOiBJTFRCb3VuZHMpID0+IHtcbiAgICByZXR1cm4gbmV3IEJCb3goby5sZWZ0LCBvLnRvcCwgby53aWR0aCwgby5oZWlnaHQsIENvb3JkU3lzLlVua25vd24pO1xuICB9LFxuXG4gIGZyb21BcnJheTogKGx0d2g6IFtudW1iZXIsIG51bWJlciwgbnVtYmVyLCBudW1iZXJdKSA9PiB7XG4gICAgY29uc3QgbGVmdCA9IGx0d2hbMF0gLyAxMDAuMDtcbiAgICBjb25zdCB0b3AgPSBsdHdoWzFdIC8gMTAwLjA7XG4gICAgY29uc3Qgd2lkdGggPSBsdHdoWzJdIC8gMTAwLjA7XG4gICAgY29uc3QgaGVpZ2h0ID0gbHR3aFszXSAvIDEwMC4wO1xuICAgIHJldHVybiBuZXcgQkJveChsZWZ0LCB0b3AsIHdpZHRoLCBoZWlnaHQsIENvb3JkU3lzLlBkZk1lZGlhKTtcbiAgfSxcbn07XG5cbmV4cG9ydCBmdW5jdGlvbiBib3hDZW50ZXJlZEF0KHA6IFBvaW50LCB3aWR0aDogbnVtYmVyLCBoZWlnaHQ6IG51bWJlcikge1xuICBjb25zdCBsZWZ0ID0gcC54IC0gd2lkdGggLyAyO1xuICBjb25zdCB0b3AgPSBwLnkgLSBoZWlnaHQgLyAyO1xuICByZXR1cm4gbWsuZnJvbUx0d2gobGVmdCwgdG9wLCB3aWR0aCwgaGVpZ2h0KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGZyb21GaWd1cmUoZmlnOiBhbnkpOiBBbnlTaGFwZSB7XG4gIGxldCBzaGFwZTtcblxuICBpZiAoZmlnLkxUQm91bmRzKSB7XG4gICAgc2hhcGUgPSBtay5mcm9tQXJyYXkoZmlnLkxUQm91bmRzKTtcbiAgfSBlbHNlIGlmIChmaWcuTGluZSkge1xuICAgIGNvbnN0IHAxID0gbWtQb2ludC5mcm9tRmxvYXRSZXBzKGZpZy5MaW5lLnAxKTtcbiAgICBjb25zdCBwMiA9IG1rUG9pbnQuZnJvbUZsb2F0UmVwcyhmaWcuTGluZS5wMik7XG4gICAgc2hhcGUgPSBuZXcgTGluZShwMSwgcDIpO1xuICB9IGVsc2UgaWYgKGZpZy5Qb2ludCkge1xuICAgIHNoYXBlID0gbWtQb2ludC5mcm9tRmxvYXRSZXBzKGZpZy5Qb2ludCk7XG4gIH0gZWxzZSBpZiAoZmlnLlRyYXBlem9pZCkge1xuICAgIGNvbnN0IHRvcFAxID0gbWtQb2ludC5mcm9tRmxvYXRSZXBzKGZpZy5UcmFwZXpvaWQudG9wTGVmdCk7XG4gICAgY29uc3QgdG9wUDIgPSBta1BvaW50LmZyb21GbG9hdFJlcHMoe1xuICAgICAgeDogZmlnLlRyYXBlem9pZC50b3BMZWZ0LnggKyBmaWcuVHJhcGV6b2lkLnRvcFdpZHRoLFxuICAgICAgeTogZmlnLlRyYXBlem9pZC50b3BMZWZ0LnksXG4gICAgfSk7XG5cbiAgICBjb25zdCBib3R0b21QMSA9IG1rUG9pbnQuZnJvbUZsb2F0UmVwcyhmaWcuVHJhcGV6b2lkLmJvdHRvbUxlZnQpO1xuICAgIGNvbnN0IGJvdHRvbVAyID0gbWtQb2ludC5mcm9tRmxvYXRSZXBzKHtcbiAgICAgIHg6IGZpZy5UcmFwZXpvaWQuYm90dG9tTGVmdC54ICsgZmlnLlRyYXBlem9pZC5ib3R0b21XaWR0aCxcbiAgICAgIHk6IGZpZy5UcmFwZXpvaWQuYm90dG9tTGVmdC55LFxuICAgIH0pO1xuXG4gICAgY29uc3QgdG9wID0gbmV3IExpbmUodG9wUDEsIHRvcFAyKTtcbiAgICBjb25zdCBib3R0b20gPSBuZXcgTGluZShib3R0b21QMSwgYm90dG9tUDIpO1xuXG4gICAgc2hhcGUgPSBuZXcgVHJhcGV6b2lkKHRvcCwgYm90dG9tKTtcbiAgfSBlbHNlIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYGNvdWxkIG5vdCBjb25zdHJ1Y3Qgc2hhcGUgZnJvbSBmaWd1cmUgJHtmaWd9YCk7XG4gIH1cblxuICByZXR1cm4gc2hhcGU7XG59XG4iXX0=